(()=>{"use strict";function t(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}function r(t){t.classList.toggle("card__like-button_is-active")}function o(t,e,n){var r=t.querySelector("".concat(n.inputErrorTypeClass).concat(e.name));e.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)}function c(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function u(t,e){var n=t.querySelector(e.submitButtonSelector);Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){o(t,n,e)})),n.disabled=!0,n.classList.add(e.inactiveButtonClass)}var a={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"459f3f15-9abd-42cb-bef4-24dbba45bbab","Content-Type":"application/json"}};function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var s,p=document.querySelector(".places__list"),l=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_edit"),d=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),m=document.querySelector(".profile__image"),y=document.forms["edit-profile"],v=document.forms["new-place"],h=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_new-card"),S=Array.from(document.querySelectorAll(".popup")),C=document.querySelector(".popup_type_image"),E=C.querySelector(".popup__image"),g=C.querySelector(".popup__caption"),k=document.querySelector(".popup_type_confirm"),q=k.querySelector(".popup__form"),L=document.querySelector(".profile__image-edit-button"),j=document.querySelector(".popup_type_new-avatar"),x=j.querySelector(".popup__form"),A={},B={};function T(t,e,n){t.querySelector(".popup__button").textContent=n}function P(t,n){p.prepend(function(t,e,n,o,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__delete-button"),i=u.querySelector(".card__image"),s=u.querySelector(".card__like-button"),p=u.querySelector(".card__like-counter");return i.src=t.link,i.alt=t.name,u.querySelector(".card__title").textContent=t.name,p.textContent=t.likes.length,e===t.owner._id?a.addEventListener("click",(function(){n(u)})):a.remove(),t.likes.some((function(t){return t._id===e}))&&r(s),s.addEventListener("click",(function(){o(s,p)})),i.addEventListener("click",c),u}(t,n,(function(n){B._id=t._id,B.cardCopy=n,e(k)}),(function(e,n){var o;e.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:a.headers}).then((function(t){return t.ok?t.json():Promise.reject("Не удалось убрать лайк: ".concat(t.status))}))}(t._id).then((function(t){n.textContent=t.likes.length,r(e)})).catch((function(t){alert(t),console.log(t)})):(o=t._id,fetch("".concat(a.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:a.headers}).then((function(t){return t.ok?t.json():Promise.reject("Не удалось лайкнуть карточку: ".concat(t.status))}))).then((function(t){n.textContent=t.likes.length,r(e)})).catch((function(t){alert(t),console.log(t)}))}),w))}function w(t){e(C),E.src=t.target.src,E.alt=t.target.alt,g.textContent=t.target.alt}S.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_is-opened")&&n(t),e.target.classList.contains("popup__close")&&n(t)}))})),l.addEventListener("click",(function(){e(_),u(y,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",inputErrorTypeClass:".popup__input-error_type_",errorClass:"popup__input-error_active"}),y.elements.name.value=d.textContent,y.elements.description.value=f.textContent})),L.addEventListener("click",(function(){e(j),x.reset(),u(x,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",inputErrorTypeClass:".popup__input-error_type_",errorClass:"popup__input-error_active"})})),x.addEventListener("submit",(function(t){var e;t.preventDefault(),T(x,0,"Сохранение..."),(e=x.elements.avatar.value,fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Изменения не сохранены! Ошибка: ".concat(t.status))}))).then((function(t){m.style="background-image: url(".concat(t.avatar,")"),n(j)})).catch((function(t){alert(t),console.log(t)})).finally((function(){T(x,0,"Сохранить")}))})),q.addEventListener("submit",(function(t){var e;t.preventDefault(),T(q,0,"Удаляется..."),(e=B._id,fetch("".concat(a.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:a.headers}).then((function(t){if(!t.ok)return Promise.reject("Не удалось удалить карточку: ".concat(t.status))}))).then((function(){B.cardCopy.remove()})).then((function(){n(k)})).catch((function(t){alert(t),console.log(t)})).finally((function(){T(q,0,"Да")}))})),y.addEventListener("submit",(function(t){var e,r;t.preventDefault(),T(y,0,"Сохранение..."),d.textContent=y.elements.name.value,f.textContent=y.elements.description.value,(e=d.textContent,r=f.textContent,fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:r})}).then((function(t){if(!t.ok)return Promise.reject("Изменения не сохранены! Ошибка: ".concat(t.status))}))).catch((function(t){alert(t),console.log(t)})).finally((function(){T(y,0,"Сохранить")})),n(_)})),h.addEventListener("click",(function(){e(b),u(v,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",inputErrorTypeClass:".popup__input-error_type_",errorClass:"popup__input-error_active"}),v.reset()})),v.addEventListener("submit",(function(t){t.preventDefault(),T(v,0,"Сохранение...");var e={};e.name=v.elements["place-name"].value,e.link=v.elements.link.value,function(t){return fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при добавлении карточки: ".concat(t.status))}))}(e).then((function(t){P(t,A.id)})).catch((function(t){alert(t),console.log(t)})).finally((function(){T(v,0,"Сохранить")})),n(b),u(v,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",inputErrorTypeClass:".popup__input-error_type_",errorClass:"popup__input-error_active"}),v.reset()})),s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",inputErrorTypeClass:".popup__input-error_type_",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(s.formSelector)).forEach((function(t){(function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);c(n,r,e),n.forEach((function(u){u.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?o(t,e,n):function(t,e,n,r){var o=t.querySelector("".concat(r.inputErrorTypeClass).concat(e.name));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,u,e),c(n,r,e)}))}))})(t,s),t.addEventListener("submit",(function(t){t.preventDefault()}))})),Promise.all([fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(t){return t.ok?t.json():Promise.reject("Не удается получить карточки")}))]).then((function(t){var e,n,r,o,c=(o=2,function(t){if(Array.isArray(t))return t}(r=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(s)throw o}}return a}}(r,o)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],a=c[1];A.id=u._id,function(t,e,n,r){t.textContent=r.name,e.textContent=r.about,n.style="background-image: url(".concat(r.avatar,")")}(d,f,m,u),e=a,n=u._id,e.reverse().forEach((function(t){P(t,n)}))})).catch((function(t){alert(t),console.log(t)}))})();
//# sourceMappingURL=main.js.map